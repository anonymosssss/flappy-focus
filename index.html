<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flappy Bird</title>

  <style>
    body {
      margin: 0;
      background: #70c5ce;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      border: 2px solid #333;
      background: #70c5ce;
    }
  </style>
</head>

<body>
  <canvas id="game" width="360" height="520"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    /* ---------- ASSETS ---------- */
    const birdImg = new Image();
    birdImg.src = "bird.png";

    const pipeImg = new Image();
    pipeImg.src = "pipe.png";

    const bgImg = new Image();
    bgImg.src = "background.png";

    const bgMusic = new Audio("subway.mp3");
    bgMusic.loop = true;
    bgMusic.volume = 1.00;

    const loseSound = new Audio("lose.mp3");
    let musicStarted = false;

    /* ---------- GAME STATE ---------- */
    let gameStarted = false;
    let gameOver = false;

    /* ---------- SCREEN SHAKE ---------- */
    let shakeTime = 0;
    const shakePower = 6;

    /* ---------- BIRD (BIGGER) ---------- */
    const bird = {
      x: 60,
      y: 200,
      w: 48,
      h: 48,
      gravity: 0.28,
      lift: -6.4,
      vel: 0
    };

    /* ---------- PIPES (REAL FLAPPY STYLE) ---------- */
    const pipes = [];
    const pipeW = 60;
    const gap = 180;
    const pipeSpacing = 200;
    let score = 0;

    function spawnPipe() {
      const minY = 120;
      const maxY = canvas.height - gap - 120;
      const top = Math.random() * (maxY - minY) + minY;

      pipes.push({
        x: canvas.width,
        top,
        bottom: canvas.height - top - gap,
        passed: false
      });
    }

    function resetGame() {
      pipes.length = 0;
      bird.y = 200;
      bird.vel = 0;
      score = 0;
      gameStarted = false;
      gameOver = false;
    }

    function lose() {
      if (gameOver) return;
      gameOver = true;
      shakeTime = 20;

      bgMusic.pause();
      bgMusic.currentTime = 0;
      musicStarted = false;

      loseSound.currentTime = 0;
      loseSound.play();
    }

    /* ---------- DRAW ---------- */
    function drawBG() {
      if (bgImg.complete) {
        ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
      } else {
        ctx.fillStyle = "#70c5ce";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
    }

    function drawBird() {
      ctx.drawImage(birdImg, bird.x, bird.y, bird.w, bird.h);
    }

    function drawPipes() {
      pipes.forEach(p => {
        ctx.save();
        ctx.translate(p.x + pipeW, p.top);
        ctx.scale(-1, -1);
        ctx.drawImage(pipeImg, 0, 0, pipeW, p.top);
        ctx.restore();

        ctx.drawImage(
          pipeImg,
          p.x,
          canvas.height - p.bottom,
          pipeW,
          p.bottom
        );
      });
    }

    function drawText() {
      ctx.textAlign = "left";
      ctx.fillStyle = "#000";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 15, 30);

      if (!gameStarted) {
        ctx.font = "26px Arial";
        ctx.fillText("CLICK OR SPACE", 85, 250);
      }

      if (gameOver) {
        ctx.textAlign = "center";

        ctx.fillStyle = "#fff";
        ctx.font = "bold 36px Arial";
        ctx.fillText("FOCUSS!", canvas.width / 2, 240);

        ctx.font = "16px Arial";
        ctx.fillText("Click / Space to Restart", canvas.width / 2, 270);

        ctx.textAlign = "left";
      }
    }

    /* ---------- UPDATE ---------- */
    function updateBird() {
      bird.vel += bird.gravity;
      bird.y += bird.vel;

      if (bird.y + bird.h > canvas.height || bird.y < 0) {
        lose();
      }
    }

    function updatePipes() {
      if (
        pipes.length === 0 ||
        canvas.width - pipes[pipes.length - 1].x >= pipeSpacing
      ) {
        spawnPipe();
      }

      pipes.forEach(p => {
        p.x -= 1.2;

        if (
          bird.x < p.x + pipeW &&
          bird.x + bird.w > p.x &&
          (bird.y < p.top ||
           bird.y + bird.h > canvas.height - p.bottom)
        ) {
          lose();
        }

        if (!p.passed && p.x + pipeW < bird.x) {
          score++;
          p.passed = true;
        }
      });

      if (pipes.length && pipes[0].x + pipeW < 0) {
        pipes.shift();
      }
    }

    /* ---------- LOOP ---------- */
    function loop() {
      if (shakeTime > 0) {
        const dx = (Math.random() - 0.5) * shakePower;
        const dy = (Math.random() - 0.5) * shakePower;
        ctx.setTransform(1, 0, 0, 1, dx, dy);
        shakeTime--;
      } else {
        ctx.setTransform(1, 0, 0, 1, 0, 0);
      }

      drawBG();
      drawBird();
      drawPipes();
      drawText();

      if (gameStarted && !gameOver) {
        updateBird();
        updatePipes();
      }

      requestAnimationFrame(loop);
    }

    /* ---------- INPUT ---------- */
    function input() {
      if (!musicStarted && !gameOver) {
        bgMusic.play();
        musicStarted = true;
      }

      if (!gameStarted) {
        gameStarted = true;
        return;
      }

      if (!gameOver) {
        bird.vel = bird.lift;
      } else {
        resetGame();
      }
    }

    document.addEventListener("click", input);
    document.addEventListener("keydown", e => {
      if (e.code === "Space") {
        e.preventDefault();
        input();
      }
    });

    /* ---------- START ---------- */
    loop();
  </script>
</body>
</html>
